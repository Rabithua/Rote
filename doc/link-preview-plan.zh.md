# 笔记链接解析与展示计划

## 目标
为笔记内容中的外部链接提供异步解析与展示能力，解析成功后展示链接预览卡片；解析失败或可读性差则不展示。

## 后端流程（最小实现）
1. 笔记创建成功后，异步触发解析任务（不阻塞创建接口）。
2. 从笔记内容中提取 URL（正则即可），对每个 URL 进行解析。
3. 解析成功且质量评分达标才落库；解析失败或可读性差不落库。

## 数据存储（最小实现）
新建表 `rote_link_previews`（命名可调整）：
- `id` UUID 主键
- `roteid` UUID（关联笔记）
- `url` text
- `title` text
- `description` text
- `image` text
- `siteName` text
- `contentExcerpt` text
- `score` integer
- `createdAt` timestamp
- 唯一索引 `(roteid, url)`，避免重复解析

## 前端展示逻辑（必须满足）
优先级规则：
1. 如果笔记引用了文章（有 `articleId`），不展示链接解析视图。
2. 如果没有引用文章，且存在链接解析结果，则展示链接解析视图。
3. 如果没有解析结果或解析失败，不展示。

## 展示样式要求
- 参考“文站引用块”的样式风格。
- 右侧增加一个小尖头区域，用于区分“可跳转”。

## 前端实现建议（基于现有页面）
可能涉及：
- `web/src/pages/rote/:roteid.tsx`
- `web/src/components/rote/roteItem.tsx`

实现步骤：
1. 在笔记详情请求结果中提供 `linkPreviews` 或单独拉取链接解析结果。
2. 渲染时按优先级规则控制显示。
3. 样式复用“文站引用块”CSS，并新增右侧尖头区。

## 风险与后续
- 解析可能失败或内容不可读，需要可观测的失败原因（可选）。
- 如果解析逻辑升级，建议记录 `parserVersion` 便于重跑（可选）。
